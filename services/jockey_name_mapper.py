"""
騎手名マッピングサービス
短縮形の騎手名をフルネームに変換
"""

# 騎手名マッピング（短縮形 -> フルネーム）
JOCKEY_NAME_MAP = {
    # あ行
    '秋山稔': '秋山稔樹',
    '秋山真': '秋山真一郎',
    '浅野': '浅野琢真',
    '荒川': '荒川龍矢',
    '石川': '石川裕紀人',
    '石神': '石神深一',
    '石神道': '石神深一',
    '石田': '石田拓人',
    '石橋脩': '石橋脩',
    '井上': '井上敏樹',
    '今村': '今村聖奈',
    '岩田望': '岩田望来',    # 追加
    '内田博': '内田博幸',
    '江田': '江田照男',
    '江田照': '江田照男',  # netkeiba形式対応
    '江田勇': '江田勇亮',
    '遠藤': '遠藤汰月',
    '大野': '大野拓弥',
    '荻野': '荻野極',

    # か行
    '柏木': '柏木健宏',
    '勝浦': '勝浦正樹',
    '上里': '上里直汰',
    '亀田': '亀田温心',
    '角田和': '角田和将',    # 追加
    '角田河': '角田河',      # 追加
    '加藤': '加藤祥太',      # 追加
    '河原田': '河原田菜々',  # 追加
    '川須': '川須栄彦',
    '川田': '川田将雅',
    '川又': '川又賢治',
    '川端': '川端海翼',  # 騎手ナレッジファイルで確認済み
    '菅原明': '菅原明良',
    '菊沢': '菊沢一樹',
    '北村宏': '北村宏司',
    '北村友': '北村友一',
    '木幡巧': '木幡巧也',
    '木幡育': '木幡育也',
    '木幡初': '木幡初也',
    '国分恭': '国分恭介',
    '小林脩': '小林脩斗',
    '小林凌': '小林凌大',
    '小沢': '小沢大仁',
    
    # さ行
    '鮫島良': '鮫島良太',
    '鮫島駿': '鮫島克駿',
    '坂井': '坂井瑠星',
    '佐々木': '佐々木大輔',
    '佐々木大輔': '佐々木大',  # ナレッジファイルは「佐々木大」で保存
    '酒井': '酒井学',        # 追加
    '柴田大': '柴田大知',
    '柴田善': '柴田善臣',
    '柴田裕': '柴田裕一',
    '嶋田': '嶋田純次',
    '島津': '島津雅生',
    '杉原': '杉原誠人',
    
    # た行
    '高倉': '高倉稜',
    '高杉': '高杉吏麒',
    '土田': '土田真翔',
    '丹内': '丹内祐次',
    '武豊': '武豊',
    '武': '武豊',
    '武士沢': '武士沢友治',
    '田中勝': '田中勝春',
    '田辺': '田辺裕信',
    '田山': '田山旺佑',  # 追加
    '太宰': '太宰啓介',
    '団野': '団野大成',    # 追加
    '津村': '津村明秀',
    '戸崎圭': '戸崎圭太',
    '戸崎': '戸崎圭太',
    '富田': '富田暁',
    '田口': '田口貫太',
    
    # な行
    '長岡': '長岡禧仁',
    '長浜': '長浜鴻緒',
    '中井': '中井裕二',
    '西塚': '西塚洸二',
    '永島': '永島まな',
    '永野': '永野猛蔵',
    '西村淳': '西村淳也',
    '西村太': '西村太一',
    '野中': '野中悠太郎',
    
    # は行
    '浜中': '浜中俊',
    '服部': '服部寿希',
    '原': '原優介',
    '原田': '原田和真',
    '菱田': '菱田裕二',
    '平沢': '平沢健治',
    '藤岡佑': '藤岡佑介',
    '藤岡康': '藤岡康太',
    '藤懸': '藤懸貴志',
    '藤田菜': '藤田菜七子',
    '古川奈': '古川奈穂',

    # ま行
    '松岡': '松岡正海',
    '松山': '松山弘平',
    '松若': '松若風馬',
    '丸田': '丸田恭介',
    '丸山': '丸山元気',
    '三浦': '三浦皇成',
    '宮崎': '宮崎北斗',
    '水沼': '水沼元輝',
    '武藤': '武藤雅',
    
    # や行
    '横山武': '横山武史',
    '横山和': '横山和生',
    '横山琉': '横山琉人',
    '横山典': '横山典弘',
    '吉田豊': '吉田豊',
    '吉田隼': '吉田隼人',
    '吉村': '吉村誠之',
    
    # ら行
    # 騎手ナレッジには「ルメール」として保存されているため、C.ルメールをルメールに変換
    'C.ルメール': 'ルメール',
    'Cルメール': 'ルメール',
    'C．ルメール': 'ルメール',
    'Ｃ．ルメール': 'ルメール',  # 全角C+全角ピリオド
    # リョンのマッピング追加
    'Ｋ．リョン': 'リョン',
    'K.リョン': 'リョン',
    # レーンは「レーン　」（全角スペース付き）で保存されているが、
    # get_jockey_dataがstrip処理をしているのでそのままでOK
    'J.レーン': 'レーン',
    'Jレーン': 'レーン',
    'J．レーン': 'レーン',

    '池添': '池添謙一',
    '岩田康': '岩田康誠',

    # モレイラのマッピング追加
    'J.モレイラ': 'モレイラ',
    'Jモレイラ': 'モレイラ',
    'Ｊ．モレイラ': 'モレイラ',

    # わ行
    '鷲頭': '鷲頭虎太',
    '和田竜': '和田竜二',
    '和田翼': '和田翼',
    '和田陽': '和田陽希',
}

def normalize_jockey_name(name: str) -> str:
    """
    騎手名を正規化（netkeiba短縮形からナレッジファイルの形式に変換）

    Args:
        name: 騎手名（netkeiba短縮形またはフルネーム）

    Returns:
        正規化された騎手名（ナレッジファイルでの形式）
    """
    # 前後の空白を除去（半角・全角両方）
    name = name.strip().strip('　')

    # 騎手記号を除去（▲減量騎手、◇女性騎手、★外国人騎手など）
    name = name.replace('▲', '').replace('◇', '').replace('★', '').replace('☆', '')

    # 記号除去後の空白も除去
    name = name.strip().strip('　')

    # 半角・全角スペースを完全除去（ナレッジファイルにスペースなし）
    name = name.replace(' ', '').replace('　', '')
    
    # まずマッピングテーブルで変換を試みる
    if name in JOCKEY_NAME_MAP:
        return JOCKEY_NAME_MAP[name]
    
    # netkeiba形式（3文字）の場合の逆引き処理
    if len(name) == 3:
        # 横山系の処理（横山○ → 横山○○を探す）
        if name.startswith('横山'):
            third_char = name[2]
            # 横山武、横山和、横山琉、横山典から探す
            candidates = {
                '武': '横山武史',
                '和': '横山和生',
                '琉': '横山琉人',
                '典': '横山典弘',
                '史': '横山武史',
                '生': '横山和生',
                '人': '横山琉人',
                '弘': '横山典弘'
            }
            if third_char in candidates:
                return candidates[third_char]
        
        # 吉田系の処理
        elif name.startswith('吉田'):
            third_char = name[2]
            candidates = {
                '豊': '吉田豊',
                '隼': '吉田隼人',
                '人': '吉田隼人',
                '浩': '吉田晃浩',
                '治': '吉田順治'
            }
            if third_char in candidates:
                return candidates[third_char]
        
        # その他の一般的な3文字変換（川端系など）
        # 既に3文字の騎手はそのまま返す可能性が高い
    
    # 特殊なケース：騎手ナレッジファイルの武豊は「武豊」（スペースなし）で保存されている
    # jockey_knowledge_manager.pyのget_jockey_dataがstrip処理を行うため、
    # スペースは不要
    
    # それ以外は元の名前を返す
    return name